---
layout:     post
title:      Rustçš„å…ƒç»„ç»“æ„ä½“
subtitle:   Rustä¸­çš„è®¾è®¡ä¹‹å¦™ğŸ¦€
date:       2025-02-28
author:     hughnian
header-img: https://picsum.photos/1024/768
catalog: true
tags:
    - rust
---

ç»“æ„ä½“è¿™ç©æ„å¾ˆå¤šè¯­è¨€éƒ½è§è¿‡ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯çº¯çº¯çš„ä¸€æ ·çš„å®šä¹‰ï¼Œä½†ç¬¬ä¸€æ¬¡çœ‹åˆ°å…ƒç»„ç»“æ„ä½“ï¼ŒçœŸä¸çŸ¥ä»€ä¹ˆç©æ„ï¼Œå››ä¸åƒã€‚çœ‹ç€æ˜¯ç»“æ„ä½“ï¼Œ ä½†ååè¿˜æœ‰å…¥å‚ã€‚è¿™æˆ–è®¸å°±æ˜¯rustçš„ç²¾å¦™ä¹‹å¤„ï¼Œçœ‹ç€å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œä½†æœ‰æ„Ÿè§‰ä¸ä¸€æ ·ã€‚çœŸæ­£äº†è§£äº†ç”¨é€”ï¼Œç¡®å®è§‰å¾—rustçš„è®¾è®¡è¿˜æ˜¯å¾ˆæœ‰ç‹¬åˆ°ã€‚  

```rust
    #[derive(Debug, Clone)]
    pub struct ServiceConfig(Rc<Inner>);  //è¿™é‡Œçš„å…ƒç»„ç»“æ„ä½“ï¼Œ Rc rustä¸­çš„å¼•ç”¨è®¡æ•°

    #[derive(Debug)]
    struct Inner {
        keep_alive: KeepAlive,
        client_request_timeout: Duration,
        client_disconnect_timeout: Duration,
        secure: bool,
        local_addr: Option<std::net::SocketAddr>,
        date_service: DateService,
    }

    impl ServiceConfig {
        pub fn new(    //åªèƒ½é€šè¿‡newè¿›è¡Œæ„é€ å®ä¾‹
            keep_alive: KeepAlive,
            client_request_timeout: Duration,
            client_disconnect_timeout: Duration,
            secure: bool,
            local_addr: Option<net::SocketAddr>,
        ) -> ServiceConfig {
            ServiceConfig(Rc::new(Inner {
                keep_alive: keep_alive.normalize(),
                client_request_timeout,
                client_disconnect_timeout,
                secure,
                local_addr,
                date_service: DateService::new(),
            }))
        }

        pub fn keep_alive(&self) -> KeepAlive {
            self.0.keep_alive
        }

        //çœç•¥å…¶ä»–æ–¹æ³•...
    }
```

## é›¶æˆæœ¬æŠ½è±¡
* ä½œç”¨ï¼šä¸ºå·²æœ‰ç±»å‹åˆ›å»ºæ–°ç±»å‹åˆ«åï¼Œä½†æä¾›æ›´å¼ºçš„ç±»å‹å®‰å…¨ã€‚
* ç‰¹ç‚¹ï¼šâœ… å®Œå…¨éšè—å®ç°ç»†èŠ‚ï¼ˆæ— æ³•ç›´æ¥è®¿é—® .0ï¼‰ã€‚âœ… å¼ºåˆ¶é€šè¿‡æ–¹æ³•è®¿é—®ï¼ˆå¦‚ keep_alive() æ–¹æ³•ï¼‰ã€‚âœ… æœªæ¥å¯çµæ´»ä¿®æ”¹å†…éƒ¨å®ç°ï¼ˆæ¯”å¦‚æ”¹æˆ Arcï¼‰ã€‚  

## å°è£…å®ç°ç»†èŠ‚
>å†…éƒ¨å¯å˜æ€§æ§åˆ¶ï¼šé€šè¿‡ `Rc<Inner>` å®ç°å…±äº«æ‰€æœ‰æƒ,æ‰€æœ‰å­—æ®µéƒ½æ˜¯ç§æœ‰çš„`ï¼ˆInnerç»“æ„ä½“æœªå…¬å¼€ï¼‰`ã€‚

>é«˜æ•ˆé…ç½®å…±äº«ï¼šé€šè¿‡`Rc`å®ç°è½»é‡çº§å…‹éš†ï¼Œ`let config_clone = config.clone();`ä»…å¢åŠ å¼•ç”¨è®¡æ•°ã€‚

>è¿è¡Œæ—¶å®‰å…¨ä¿éšœï¼šæ‰€æœ‰ä¿®æ”¹æ“ä½œå¿…é¡»é€šè¿‡ç»“æ„ä½“æ–¹æ³•,å¦‚`keep_alive`åªèƒ½é€šè¿‡config.keep_alive()æ–¹æ³•è·å–ã€‚